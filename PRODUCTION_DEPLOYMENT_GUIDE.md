# Production Deployment Guide

## Overview
This guide covers deploying the Godlywomen app to production:
- **Frontend**: Vercel
- **Backend**: Railway, Heroku, or similar platforms

## Backend Deployment (Django)

### Prerequisites
- PostgreSQL database (Railway provides one)
- Python 3.10+
- Environment variables properly configured

### Environment Variables Required

```bash
# Django Settings
DJANGO_SECRET_KEY=<generate-secure-key>
DEBUG=False
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com,api.yourdomain.com

# Database (Railway auto-provides DATABASE_URL)
DATABASE_URL=postgresql://user:pass@host:port/dbname

# CORS Settings - Add your Vercel domain
CORS_ALLOWED_ORIGINS=https://yourdomain.vercel.app,https://yourdomain.com

# Email Configuration (optional, for password reset)
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
```

### Generate Django Secret Key
```bash
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

### Deploy to Railway

1. **Connect GitHub Repository**
   - Push code to GitHub
   - Go to railway.app
   - Create new project → Deploy from GitHub
   - Select godlywomen repository

2. **Configure Build Command**
   ```
   pip install -r requirements_production.txt && python manage.py migrate
   ```

3. **Configure Start Command**
   ```
   gunicorn backend_project.wsgi
   ```

4. **Set Environment Variables**
   - Add all required environment variables in Railway dashboard
   - DATABASE_URL is auto-generated by Railway

5. **Database Setup**
   - Railway automatically provides PostgreSQL
   - Add `psycopg2-binary` to requirements (already in requirements_production.txt)

6. **Run Migrations**
   - SSH into Railway container or run via dashboard:
   ```
   python manage.py migrate
   python manage.py createsuperuser
   ```

### Deploy to Heroku

1. **Install Heroku CLI**
   ```bash
   brew install heroku/brew/heroku
   heroku login
   ```

2. **Create app and add PostgreSQL**
   ```bash
   heroku create your-app-name
   heroku addons:create heroku-postgresql:standard-0
   ```

3. **Set Environment Variables**
   ```bash
   heroku config:set DJANGO_SECRET_KEY=<your-key>
   heroku config:set DEBUG=False
   heroku config:set ALLOWED_HOSTS=your-app-name.herokuapp.com
   heroku config:set CORS_ALLOWED_ORIGINS=https://yourdomain.vercel.app
   ```

4. **Create Procfile**
   ```
   web: gunicorn backend_project.wsgi --log-file -
   release: python manage.py migrate
   ```

5. **Deploy**
   ```bash
   git push heroku main
   ```

### Create Superuser
```bash
python manage.py createsuperuser
```

---

## Frontend Deployment (Next.js on Vercel)

### Environment Variables Required

Create `.env.production.local`:

```
NEXT_PUBLIC_APP_URL=https://yourdomain.vercel.app
NEXT_PUBLIC_DJANGO_API=https://api.yourdomain.com
NEXTAUTH_URL=https://yourdomain.vercel.app
NEXTAUTH_SECRET=<generate-secure-key>
```

### Generate NextAuth Secret
```bash
openssl rand -base64 32
```

### Deploy to Vercel

1. **Connect GitHub Repository**
   - Go to vercel.com
   - Import from Git → Select godlywomen repo
   - Vercel auto-detects Next.js

2. **Set Environment Variables**
   - Go to Settings → Environment Variables
   - Add all production environment variables
   - Add variables to Production environment

3. **Configure Build Settings**
   - Build Command: `npm run build`
   - Output Directory: `.next`
   - (Already configured in next.config.ts)

4. **Deploy**
   - Vercel auto-deploys on git push
   - Or manually trigger deployment

---

## Security Checklist

- [ ] Django SECRET_KEY is random and secure
- [ ] DEBUG=False in production
- [ ] ALLOWED_HOSTS restricted to your domains
- [ ] CORS_ALLOWED_ORIGINS restricted to your frontend domain
- [ ] PostgreSQL used (not SQLite) for database
- [ ] SSL/HTTPS enforced (SECURE_SSL_REDIRECT=True)
- [ ] CSRF cookies are secure and HttpOnly
- [ ] Session cookies are secure and HttpOnly
- [ ] Strong password requirements enabled
- [ ] Rate limiting configured in REST_FRAMEWORK
- [ ] NEXTAUTH_SECRET is random and secure
- [ ] No console.logs or debug code in production
- [ ] Environment variables never committed to git

---

## Post-Deployment

### Check Backend Health
```bash
curl https://api.yourdomain.com/
```

### Check Frontend Health
```bash
curl https://yourdomain.vercel.app/
```

### Monitor Logs
- Railway/Heroku: Check dashboard logs
- Vercel: Check deployment logs and function logs

### Test Authentication Flow
1. Visit frontend
2. Create account
3. Sign in
4. Verify JWT tokens in request headers

---

## Troubleshooting

### "Authentication credentials were not provided"
- Check CORS_ALLOWED_ORIGINS includes your frontend domain
- Verify frontend NEXT_PUBLIC_DJANGO_API is correct

### Database Connection Errors
- Verify DATABASE_URL is set
- Check PostgreSQL is running
- Run `python manage.py migrate` after deployment

### Static Files 404
- Run `python manage.py collectstatic --noinput`
- Check STATIC_ROOT and STATIC_URL settings

### CORS Errors
- Add frontend domain to CORS_ALLOWED_ORIGINS
- Verify backend is returning proper CORS headers

---

## Performance Optimization

1. **Database Indexing**: Add indexes for frequently queried fields
2. **Caching**: Configure Redis for session storage (Railway/Heroku)
3. **CDN**: Vercel handles frontend; consider CloudFront for media files
4. **Compression**: Enable gzip in middleware
5. **Database Pooling**: Use pgBouncer for connection pooling

---

## Monitoring & Logging

### Backend Logs
- Check application logs in Railway/Heroku dashboard
- Configure structured logging with Python logging module

### Frontend Logs
- Vercel provides build and deployment logs
- Monitor client-side errors via browser DevTools

### Performance Monitoring
- Add application performance monitoring (APM) tool
- Consider Sentry for error tracking
